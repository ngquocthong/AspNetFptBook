@using BusinessObjects;
@model List<CartItem>
<main class="page shopping-cart-page">
	<section class="clean-block clean-cart dark">
		@if (Model.Count > 0)
		{
			double total = 0;
			int stt = 1;
			<div class="container">
				<div class="block-heading">
					<h2 class="text-info">Shopping Cart</h2>
				</div>
				<div class="content">
					<div class="row g-0">
						<div class="col-md-12 col-lg-8">
							<div class="items">
								@foreach (var cartitem in Model)
								{
									var totals = cartitem.book.quantity * cartitem.book.book_price;
									total += totals;
									<div class="product">
										<div class="row justify-content-center align-items-center">
											<div class="col-md-3">
												<div class="product-image"><img class="img-fluid d-block mx-auto image" src="assets/img/tech/image2.jpg"></div>
											</div>
											<div class="col-md-5 product-info" style="width: 240px;"><a class="product-name" href="#">@cartitem.book.book_name</a></div>
											<div class="col-6 col-md-2 quantity"><label class="form-label d-none d-md-block" for="quantity">Quantity</label><input type="number" id="number" class="form-control quantity-input" value="1" asp-for="@cartitem.quantity" id="@($"quantity-{cartitem.book.ID}")" /></div>
											<div class="col-6 col-md-2 price" style="width: 96px;"><span>@(total.ToString("n0"))</span></div>
											<div class="col-6 col-md-2 price">
												<a data-id="@cartitem.book.ID" class="updatecartitem">
													<i class="fas fa-sync" style="margin-right: 30px;font-size: 30px; color: var(--bs-orange);">Update</i>
												</a>
												<a asp-route="removecart" asp-route-id="@cartitem.book.ID">
													<i class="fas fa-trash" style="font-size: 30px; color: var(--bs-red);">
														Delete
													</i>
												</a>
											</div>
										</div>
										<div class="col-md-12 col-lg-4">
											<div class="summary">
												<h3>Summary</h3>
												<h4><span class="text">Subtotal</span><span class="price">@(total.ToString("n0"))</span></h4>
												<h4><span class="text">Discount</span><span class="price">$0</span></h4>
												<h4><span class="text">Shipping</span><span class="price">$0</span></h4>
												<h4><span class="text">Total</span><span class="price">@(total.ToString("n0"))</span></h4>\
												<button class="btn btn-primary btn-lg d-block w-100" type="button">Order</button>
											</div>
										</div>
									</div>
								}
							</div>
						</div>
					</div>
				</div>
			</div>
		}
		else
		{
			<p class="alert alert-danger">Giỏ hàng trống</p>
		}
	</section>
</main>
@section Scripts {
	<script>
		$(document).ready(function () {
			$(".updatecartitem").click(function (event) {
				event.preventDefault();
				var id = $(this).attr("data-id");
				var quantity = $("#quantity-" + id).val();
				$.ajax({
					type: "POST",
					url: "@Url.RouteUrl("updatecart")",
					data: {
						id: id,
						quantity: quantity
					},
					success: function (result) {
						window.location.href = "@Url.RouteUrl("cart")";
					}
				});
			});
		});
	</script>
    }
		}